# 09 基础登功能

## 设计思路

好的，下面是设计基础登录功能的思路：

### 1. 登录页面设计

#### 1.1 UI 设计

- **表单结构**: 包括用户名输入框、密码输入框和提交按钮。
- **用户体验**: 提供必要的表单验证（如必填字段、密码格式等）和错误提示。

### 2. 表单处理

#### 2.1 收集用户输入

- **数据绑定**: 通过双向绑定收集用户名和密码输入值。
- **表单验证**: 实现前端验证逻辑，比如检查输入是否为空。

#### 2.2 表单提交

- **阻止默认提交行为**: 使用事件处理来阻止默认的表单提交行为，并改为通过 JavaScript 进行处理。

### 3. API 请求

#### 3.1 创建 Axios 实例

- **配置基础 URL**: 设置 API 基础路径和超时配置。
- **请求拦截器**: 在请求头中添加必要的身份验证信息（如 token）。

#### 3.2 封装登录请求

- **定义 API 调用**: 封装一个发送用户名和密码到后端的登录请求函数。

### 4. 状态管理

#### 4.1 存储用户信息

- **使用 Vuex 或 Pinia**: 将登录后的用户信息存储在全局状态管理器中。
- **本地存储**: 将 token 存储在 localStorage 或 sessionStorage 中，以便在刷新页面后仍能保持登录状态。

### 5. 错误处理

#### 5.1 处理登录失败

- **错误提示**: 在 UI 上显示错误信息，如用户名或密码错误。
- **日志记录**: 记录错误信息，便于调试和监控。

### 6. 路由跳转

#### 6.1 登录成功后的跳转

- **重定向到主页或目标页面**: 登录成功后，根据用户的角色或权限重定向到相应的页面。
- **保存跳转前的路径**: 如果用户是从某个受保护页面跳转到登录页，登录成功后应跳转回该页面。

### 7. 鉴权和访问控制

#### 7.1 前端路由守卫

- **全局前置守卫**: 在路由跳转前检查用户是否已经登录，未登录则跳转到登录页。
- **权限检查**: 根据用户的权限决定是否允许访问某些路由。

### 8. 退出登录

#### 8.1 实现退出功能

- **清除用户状态**: 清除全局状态管理器中的用户信息和本地存储中的 token。
- **重定向到登录页**: 退出登录后将用户重定向到登录页。

### 总结

通过以上步骤，可以设计和实现一个基础的前端登录功能，确保用户能够安全、顺利地进行登录操作，同时前端能够正确处理用户状态和权限控制。

## 登陆后其他操作

在用户成功登录之后，前端需要进行一系列操作来确保用户可以正常使用应用，并且可以安全地管理用户会话和权限。以下是登录之后应该进行的步骤和注意事项：

### 1. 存储用户信息

#### 1.1 存储 Token

- **本地存储**: 将从服务器获取的身份验证 token 存储在 `localStorage` 或 `sessionStorage` 中，以便在后续的 API 请求中使用。
- **全局状态管理**: 使用 Vuex 或 Pinia 将 token 和用户信息存储在全局状态中，便于全局访问和管理。

#### 1.2 存储用户信息

- **用户信息**: 将用户信息（如用户名、角色、权限等）存储在全局状态管理器中，以便在整个应用中使用。

### 2. 设置 Axios 请求头

#### 2.1 添加 Token 到请求头

- **请求拦截器**: 在 Axios 的请求拦截器中添加 token 到所有请求的请求头中，确保每个请求都携带身份验证信息。

### 3. 路由跳转

#### 3.1 重定向到主页或目标页面

- **主页重定向**: 如果没有指定目标页面，通常重定向到应用的主页。
- **原路径重定向**: 如果用户在访问受保护页面时被重定向到登录页，登录成功后应重定向回原路径。

### 4. 权限管理

#### 4.1 设置权限

- **权限存储**: 将用户权限信息存储在全局状态管理器中。
- **权限检查**: 在路由守卫和组件中根据权限信息控制页面和功能的访问。

### 5. 更新 UI

#### 5.1 显示用户信息

- **用户界面更新**: 更新页面头部或侧边栏显示登录用户的信息（如用户名、头像等）。
- **菜单更新**: 根据用户的角色和权限显示不同的导航菜单项。

### 6. 会话管理

#### 6.1 设置会话超时

- **自动登出**: 设置会话超时，当用户长时间未操作时，自动登出并重定向到登录页。
- **会话续期**: 用户在操作时自动续期会话时间，避免频繁登录。

### 7. 错误处理

#### 7.1 全局错误处理

- **错误通知**: 统一处理所有 API 请求中的错误，弹出错误提示。
- **日志记录**: 将错误信息记录到日志系统，以便后续分析和调试。

### 8. 安全措施

#### 8.1 防止 XSS 和 CSRF 攻击

- **XSS 防护**: 确保在渲染用户输入时进行适当的转义。
- **CSRF 防护**: 在请求中包含 CSRF token，防止跨站请求伪造攻击。

### 9. 退出登录

#### 9.1 清除用户信息

- **清除本地存储**: 删除 `localStorage` 或 `sessionStorage` 中的 token 和用户信息。
- **清除全局状态**: 重置 Vuex 或 Pinia 中的用户状态。

#### 9.2 重定向到登录页

- **页面跳转**: 退出登录后重定向到登录页，确保用户必须重新认证才能访问受保护的内容。

### 总结

登录成功之后，前端需要进行一系列操作来管理用户会话和权限，确保应用的安全性和用户体验。这些操作包括存储用户信息和 token、设置请求头、路由重定向、权限管理、更新 UI、会话管理、全局错误处理、安全措施以及处理退出登录。这些步骤可以帮助确保用户能够安全、顺利地使用应用，并且保护应用免受常见的安全威胁。
